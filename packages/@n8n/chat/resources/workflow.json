{
	"name": "AI Webhook Chat",
	"nodes": [
		{
			"parameters": {
				"httpMethod": "POST",
				"path": "513107b3-6f3a-4a1e-af21-659f0ed14183",
				"responseMode": "responseNode",
				"options": {
					"domainAllowlist": "*.localhost"
				}
			},
			"id": "51ab2689-647d-4cff-9d6f-0ba4df45e904",
			"name": "Webhook",
			"type": "n8n-nodes-base.webhook",
			"typeVersion": 1,
			"position": [100, 480],
			"webhookId": "513107b3-6f3a-4a1e-af21-659f0ed14183"
		},
		{
			"parameters": {
				"options": {}
			},
			"id": "3c7fd563-f610-41fa-b198-7fcf100e2815",
			"name": "Chat OpenAI",
			"type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
			"typeVersion": 1,
			"position": [700, 840],
			"credentials": {}
		},
		{
			"parameters": {
				"sessionKey": "={{ $json.body.sessionId }}"
			},
			"id": "ebc23ffa-3bcf-494f-bcb8-51a5fff91885",
			"name": "Window Buffer Memory",
			"type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
			"typeVersion": 1,
			"position": [840, 840]
		},
		{
			"parameters": {
				"simplifyOutput": false
			},
			"id": "d6721a60-159b-4a93-ac6b-b81e16d9f16f",
			"name": "Memory Chat Retriever",
			"type": "@n8n/n8n-nodes-langchain.memoryChatRetriever",
			"typeVersion": 1,
			"position": [780, 240]
		},
		{
			"parameters": {
				"sessionKey": "={{ $json.body.sessionId }}"
			},
			"id": "347edc3a-1dda-4996-b778-dcdc447ecfd8",
			"name": "Memory Chat Retriever Window Buffer Memory",
			"type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
			"typeVersion": 1,
			"position": [800, 440]
		},
		{
			"parameters": {
				"options": {
					"responseCode": 200,
					"responseHeaders": {
						"entries": [
							{
								"name": "sessionId",
								"value": "={{ $json.body.sessionId }}"
							}
						]
					}
				}
			},
			"id": "d229963e-e2f1-4381-87d2-47043bd6ccc7",
			"name": "Respond to Webhook",
			"type": "n8n-nodes-base.respondToWebhook",
			"typeVersion": 1,
			"position": [1460, 500]
		},
		{
			"parameters": {
				"dataType": "string",
				"value1": "={{ $json.body.action }}",
				"rules": {
					"rules": [
						{
							"value2": "loadPreviousSession"
						},
						{
							"value2": "sendMessage",
							"output": 1
						}
					]
				}
			},
			"id": "fc4ad994-5f38-4dce-b1e5-397acc512687",
			"name": "Chatbot Action",
			"type": "n8n-nodes-base.switch",
			"typeVersion": 1,
			"position": [540, 480]
		},
		{
			"parameters": {
				"jsCode": "const response = { data: [] };\n\nfor (const item of $input.all()) {\n  response.data.push(item.json);\n}\n\nreturn {\n  json: response,\n  pairedItem: 0\n};"
			},
			"id": "e1a80bdc-411a-42df-88dd-36915b1ae8f4",
			"name": "Code",
			"type": "n8n-nodes-base.code",
			"typeVersion": 2,
			"position": [1160, 240]
		},
		{
			"parameters": {
				"jsCode": "for (const item of $input.all()) {\n  item.json.body = JSON.parse(item.json.body);\n}\n\nreturn $input.all();"
			},
			"id": "809fe3b8-ad9e-4264-8184-18bdecf581fb",
			"name": "Parse Request JSON",
			"type": "n8n-nodes-base.code",
			"typeVersion": 2,
			"position": [320, 480]
		},
		{
			"parameters": {
				"text": "={{ $json.body.message }}",
				"options": {}
			},
			"id": "c43f9232-0636-4c95-a3ad-1addd8c74f6e",
			"name": "Agent",
			"type": "@n8n/n8n-nodes-langchain.agent",
			"typeVersion": 1,
			"position": [780, 600]
		}
	],
	"connections": {
		"Webhook": {
			"main": [
				[
					{
						"node": "Parse Request JSON",
						"type": "main",
						"index": 0
					}
				]
			]
		},
		"Chat OpenAI": {
			"ai_languageModel": [
				[
					{
						"node": "Agent",
						"type": "ai_languageModel",
						"index": 0
					}
				]
			]
		},
		"Window Buffer Memory": {
			"ai_memory": [
				[
					{
						"node": "Agent",
						"type": "ai_memory",
						"index": 0
					}
				]
			]
		},
		"Memory Chat Retriever": {
			"main": [
				[
					{
						"node": "Code",
						"type": "main",
						"index": 0
					}
				]
			]
		},
		"Memory Chat Retriever Window Buffer Memory": {
			"ai_memory": [
				[
					{
						"node": "Memory Chat Retriever",
						"type": "ai_memory",
						"index": 0
					}
				]
			]
		},
		"Chatbot Action": {
			"main": [
				[
					{
						"node": "Memory Chat Retriever",
						"type": "main",
						"index": 0
					}
				],
				[
					{
						"node": "Agent",
						"type": "main",
						"index": 0
					}
				]
			]
		},
		"Code": {
			"main": [
				[
					{
						"node": "Respond to Webhook",
						"type": "main",
						"index": 0
					}
				]
			]
		},
		"Parse Request JSON": {
			"main": [
				[
					{
						"node": "Chatbot Action",
						"type": "main",
						"index": 0
					}
				]
			]
		},
		"Agent": {
			"main": [
				[
					{
						"node": "Respond to Webhook",
						"type": "main",
						"index": 0
					}
				]
			]
		}
	}
}
